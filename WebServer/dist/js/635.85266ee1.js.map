{"version":3,"file":"js/635.85266ee1.js","mappings":"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","sources":["webpack://webserve/./src/views/back/Dynamics.vue","webpack://webserve/./src/views/back/Dynamics.vue?afe2"],"sourcesContent":["<template>\r\n    <div class=\"container\">\r\n      <div>因为服务器算力较差，所以这个模块对于图片加载可能会很慢，即使我用了更加强大的技术，还是会有点慢</div>\r\n      <div>所以请耐心等待，如果图片加载不出来，可以刷新一下页面</div>\r\n      <div>用户：{{username }}</div>\r\n      <div class=\"input-area\">\r\n        <textarea v-model=\"inputText\" placeholder=\"输入文字\"></textarea>\r\n        <input type=\"file\" @change=\"selectImage\" accept=\"image/*\" />\r\n        <el-button type=\"primary\" @click=\"sendMessage('ruleForm')\">发送</el-button>\r\n      </div>\r\n      <div class=\"display-area\">\r\n        <el-row>\r\n      <el-col v-for=\"(message, index) in messages\" :key=\"index\" class=\"message\">\r\n        <el-card :body-style=\"{ padding: '0px' }\">\r\n          <img v-if=\"message.image\" :src=\"message.image\" alt=\"发送的图片\" style=\"max-width: 100%; height: auto;\"/>\r\n          <div style=\"padding: 14px\"><p>{{ message.text }}</p></div>\r\n        </el-card> \r\n      </el-col>\r\n    </el-row>\r\n      </div>\r\n    </div>\r\n  </template>\r\n  \r\n  <script>\r\n  import { ref } from 'vue';\r\n  import axios from 'axios';\r\n  \r\n  export default { \r\n    name: 'DynamicPage',\r\n    data() {\r\n      return {\r\n        inputText: '',\r\n        selectedImage: null,\r\n        messages: [],// 存储聊天消息\r\n        username: '',\r\n        //获取时间\r\n        year: '',\r\n        month: '',\r\n        day: '',\r\n        hour: '',\r\n        minute: '',\r\n        second: '',\r\n      };\r\n    },\r\n    mounted() {\r\n      this.loadHistoryDyn(); // 在组件加载时调用加载历史消息的方法\r\n      this.username = this.$route.query.username; // 从路由中获取用户名\r\n      const now = new Date();\r\n      const options = {\r\n        year: 'numeric',\r\n        month: '2-digit',\r\n        day: '2-digit',\r\n        hour: '2-digit',\r\n        minute: '2-digit',\r\n        second: '2-digit',\r\n        hour12: false,\r\n        timeZone: 'Asia/Shanghai',\r\n      };\r\n      const date = now.toLocaleString('en-US', options).split(', ')[0];\r\n      const time = now.toLocaleString('en-US', options).split(', ')[1];\r\n      [this.month, this.day, this.year] = date.split('/');\r\n      [this.hour, this.minute, this.second] = time.split(':');\r\n    },\r\n    methods: {\r\n      //加载历史的动态消息\r\n      loadHistoryDyn() {\r\n            axios.get('http://localhost:8081/api/history-dynamics') // 发送GET请求获取历史消息数据\r\n            .then(response => {\r\n            var msgs = response.data.msg; // 将返回的历史消息数据存储到messages数组中\r\n            var user = response.data.user;\r\n            var img = response.data.dyn;\r\n            //msgs是一个json数组，对他进行遍历\r\n            for (var i = 0; i < msgs.length; i++) {\r\n                var mess = {\r\n                  text: user[i] + \":\" + msgs[i],\r\n                  image: \"data:image/jpeg;base64,\" + img[i],\r\n                };\r\n                this.messages.push(mess);\r\n            }\r\n            \r\n        })\r\n          .catch(error => {\r\n          console.error('Failed to load history messages:', error);\r\n        });\r\n        },\r\n\r\n      selectImage(event) {\r\n        this.selectedImage = event.target.files[0];\r\n      },\r\n\r\n      //获取图片和文字，并且向后端发送动态。\r\n      sendMessage() {\r\n        const message = {\r\n          text: this.username + \":\"+ this.year+\"年\"+ this.month+\"月\"+this.day+\"日\"+this.hour+\"时\"+this.minute+\"分\"+this.second+\"秒 写到：\" + this.inputText,\r\n          image: null,\r\n        };\r\n  \r\n        if (this.selectedImage) {\r\n          const reader = new FileReader();\r\n          reader.onload = () => {\r\n            message.image = reader.result;\r\n            console.log(reader.result);\r\n            const imageBase64 = reader.result.split(',')[1];\r\n            axios.get('http://localhost:8081/api/send-dynamics', {\r\n            //必须要指定params参数，否则后端无法获取到该参数\r\n              params: {\r\n                msg : this.year+\"年\"+ this.month+\"月\"+this.day+\"日\"+this.hour+\"时\"+this.minute+\"分\"+this.second+\"秒 写到：\" +this.inputText,\r\n                img : imageBase64,\r\n                user : this.username,\r\n              }\r\n            }).then(response => {\r\n                if (response.data.state == \"right\"){\r\n                  alert(\"发送成功\");\r\n                  this.messages.push(message);\r\n                  this.clearInput();\r\n                } else{\r\n                  alert(\"发送失败\");\r\n              }\r\n            }).catch(error => {\r\n                console.error('Failed to send message:', error);\r\n            });\r\n          };\r\n          reader.readAsDataURL(this.selectedImage);\r\n        } else {\r\n          this.messages.push(message);\r\n          this.clearInput();\r\n        }\r\n      },\r\n\r\n      //对于之前的资源进行清理\r\n      clearInput() {\r\n        this.inputText = '';\r\n        this.selectedImage = null;\r\n      }\r\n    }\r\n  };\r\n  </script>\r\n  \r\n  <style>\r\n  .container {\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n    padding: 20px;\r\n  }\r\n  \r\n  .input-area {\r\n    display: flex;\r\n    align-items: center;\r\n    margin-bottom: 20px;\r\n  }\r\n  \r\n  textarea {\r\n    width: 300px;\r\n    height: 45px;\r\n    resize: vertical;\r\n    margin-right: 10px;\r\n  }\r\n  \r\n  .display-area {\r\n    /* max-height: 400px;\r\n    overflow-y: scroll; */\r\n    background-image: url('../../assets/ChatBackgroud.png'); /* 设置背景图片路径 */\r\n    flex-grow: 1;\r\n    overflow-y: auto;\r\n    border: 1px solid #ccc;\r\n    padding: 10px;\r\n    width: 1000px;\r\n    height: 600px;\r\n  }\r\n  \r\n  .message {\r\n    margin-bottom: 10px;\r\n    padding: 10px;\r\n    border: 1px solid #ccc;\r\n  }\r\n  </style>","import { render } from \"./Dynamics.vue?vue&type=template&id=4e6819c2\"\nimport script from \"./Dynamics.vue?vue&type=script&lang=js\"\nexport * from \"./Dynamics.vue?vue&type=script&lang=js\"\n\nimport \"./Dynamics.vue?vue&type=style&index=0&id=4e6819c2&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["class","_createElementVNode","style","_createElementBlock","_hoisted_1","_hoisted_2","_hoisted_3","_toDisplayString","$data","username","_hoisted_4","_cache","$event","inputText","placeholder","type","onChange","args","$options","selectImage","accept","_createVNode","_component_el_button","onClick","sendMessage","default","_withCtx","_createTextVNode","_","_hoisted_5","_component_el_row","_Fragment","_renderList","messages","message","index","_createBlock","_component_el_col","key","_component_el_card","padding","image","src","alt","_hoisted_6","_createCommentVNode","_hoisted_7","text","name","data","selectedImage","year","month","day","hour","minute","second","mounted","this","loadHistoryDyn","$route","query","now","Date","options","hour12","timeZone","date","toLocaleString","split","time","methods","axios","get","then","response","msgs","msg","user","img","dyn","i","length","mess","push","catch","error","console","event","target","files","reader","FileReader","onload","result","log","imageBase64","params","state","alert","clearInput","readAsDataURL","__exports__","render"],"sourceRoot":""}